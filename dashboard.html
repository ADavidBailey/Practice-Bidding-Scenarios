<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBS Activity Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
            font-size: 14px;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-card h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
        }
        .activity-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .activity-card h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .activity-list {
            max-height: 250px;
            overflow-y: auto;
        }
        .activity-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .activity-item:last-child {
            border-bottom: none;
        }
        .activity-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }
        .type-file_save { background: #dbeafe; color: #1d4ed8; }
        .type-pipeline_run { background: #dcfce7; color: #166534; }
        .type-session_start { background: #fef3c7; color: #92400e; }
        .type-session_end { background: #fee2e2; color: #991b1b; }
        .activity-time {
            color: #999;
            font-size: 11px;
        }
        .commit-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }
        .commit-item:last-child {
            border-bottom: none;
        }
        .commit-hash {
            font-family: monospace;
            color: #6366f1;
            font-size: 12px;
        }
        .commit-message {
            color: #333;
            margin-left: 8px;
        }
        .commit-date {
            color: #999;
            font-size: 11px;
            display: block;
            margin-top: 4px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #999;
            font-size: 14px;
        }
        .no-data {
            color: #999;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }
        @media (max-width: 900px) {
            .stats { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 600px) {
            .stats { grid-template-columns: repeat(2, 1fr); }
            .chart-grid { grid-template-columns: 1fr; }
            .activity-grid { grid-template-columns: 1fr; }
        }
    </style>
    <script>
const DASHBOARD_DATA = {
  "generatedAt": "2026-02-01T09:01:03.445613",
  "summary": {
    "totalScenarios": 298,
    "scenariosWorked": 298,
    "totalFileEdits": 50474,
    "totalPipelineRuns": 95,
    "totalSessionHours": 3067,
    "totalCommits": 5439
  },
  "charts": {
    "labels": [
      "Oct 23",
      "Nov 23",
      "Dec 23",
      "Jan 24",
      "Feb 24",
      "Mar 24",
      "Apr 24",
      "May 24",
      "Jun 24",
      "Jul 24",
      "Aug 24",
      "Sep 24",
      "Oct 24",
      "Nov 24",
      "Dec 24",
      "Jan 25",
      "Feb 25",
      "Mar 25",
      "Apr 25",
      "May 25",
      "Jun 25",
      "Jul 25",
      "Aug 25",
      "Sep 25",
      "Oct 25",
      "Nov 25",
      "Dec 25",
      "Jan 26",
      "Feb 26"
    ],
    "fileEdits": [
      423,
      450,
      423,
      253,
      292,
      377,
      243,
      4406,
      5419,
      2185,
      232,
      767,
      12932,
      7709,
      585,
      998,
      819,
      1572,
      1508,
      3782,
      595,
      314,
      250,
      870,
      1779,
      678,
      506,
      95,
      12
    ],
    "pipelineRuns": [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      61,
      34
    ],
    "commits": [
      472,
      502,
      441,
      259,
      304,
      391,
      255,
      82,
      209,
      187,
      41,
      175,
      297,
      490,
      111,
      87,
      80,
      132,
      116,
      65,
      66,
      30,
      21,
      93,
      159,
      80,
      62,
      228,
      4
    ],
    "sessionHours": [
      157,
      145,
      171,
      75,
      140,
      158,
      83,
      66,
      143,
      158,
      47,
      141,
      204,
      206,
      113,
      75,
      76,
      83,
      112,
      58,
      70,
      37,
      35,
      100,
      131,
      102,
      69,
      97,
      15
    ],
    "scenariosWorked": [
      17,
      59,
      74,
      85,
      110,
      113,
      123,
      128,
      130,
      167,
      168,
      175,
      182,
      198,
      210,
      217,
      227,
      240,
      247,
      254,
      258,
      258,
      259,
      261,
      272,
      275,
      281,
      298,
      298
    ]
  },
  "recentActivity": [
    {
      "timestamp": "2026-02-01T03:46:51.115Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "*"
      }
    },
    {
      "timestamp": "2026-02-01T03:47:51.482Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N-P-2C",
        "operation": "*"
      }
    },
    {
      "timestamp": "2026-02-01T03:48:47.849Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "*"
      }
    },
    {
      "timestamp": "2026-02-01T03:51:29.714Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbs"
      }
    },
    {
      "timestamp": "2026-02-01T03:51:57.554Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbs"
      }
    },
    {
      "timestamp": "2026-02-01T03:52:05.639Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbs"
      }
    },
    {
      "timestamp": "2026-02-01T03:52:11.114Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbn"
      }
    },
    {
      "timestamp": "2026-02-01T04:15:41.434Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbs"
      }
    },
    {
      "timestamp": "2026-02-01T04:16:03.204Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbn"
      }
    },
    {
      "timestamp": "2026-02-01T04:16:42.407Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "pbn"
      }
    },
    {
      "timestamp": "2026-02-01T04:25:54.409Z",
      "type": "file_save",
      "details": {
        "filePath": "btn/GIB_1N.btn",
        "fileType": "btn"
      }
    },
    {
      "timestamp": "2026-02-01T04:26:01.242Z",
      "type": "pipeline_run",
      "details": {
        "scenario": "GIB_1N",
        "operation": "*"
      }
    },
    {
      "timestamp": "2026-02-01T04:50:06.137Z",
      "type": "file_save",
      "details": {
        "filePath": "-PBS.BETA",
        "fileType": "beta"
      }
    },
    {
      "timestamp": "2026-02-01T05:08:23.890Z",
      "type": "file_save",
      "details": {
        "filePath": "-PBS.BETA",
        "fileType": "beta"
      }
    },
    {
      "timestamp": "2026-02-01T05:09:23.044Z",
      "type": "file_save",
      "details": {
        "filePath": "-PBS.BETA",
        "fileType": "beta"
      }
    },
    {
      "timestamp": "2026-02-01T05:20:15.101Z",
      "type": "file_save",
      "details": {
        "filePath": "js/toggleRandomlyRotate.js",
        "fileType": "javascript"
      }
    },
    {
      "timestamp": "2026-02-01T14:13:49.792Z",
      "type": "session_end",
      "details": {
        "durationMinutes": 952
      }
    },
    {
      "timestamp": "2026-02-01T14:13:51.625Z",
      "type": "session_start",
      "details": {}
    },
    {
      "timestamp": "2026-02-01T14:15:22.656Z",
      "type": "session_end",
      "details": {
        "durationMinutes": 2
      }
    },
    {
      "timestamp": "2026-02-01T14:15:23.929Z",
      "type": "session_start",
      "details": {}
    }
  ],
  "recentCommits": [
    {
      "hash": "bd446a15",
      "date": "2026-02-01 08:12:41 -0600",
      "message": "Add scenario index CSV for Google Sheets import"
    },
    {
      "hash": "44ff44b6",
      "date": "2026-02-01 06:01:51 -0800",
      "message": "Add Stayman scenario pipeline artifacts"
    },
    {
      "hash": "6b0e93c8",
      "date": "2026-02-01 05:52:25 -0800",
      "message": "Add quiz folder and operation to VS Code extension"
    },
    {
      "hash": "8694bb62",
      "date": "2026-02-01 05:49:16 -0800",
      "message": "Rotate quiz hands to South position with correct dealer"
    },
    {
      "hash": "8e0ad2c0",
      "date": "2026-01-31 23:30:05 -0600",
      "message": "toggle Rotate"
    },
    {
      "hash": "c69c1fb1",
      "date": "2026-01-31 23:10:16 -0600",
      "message": "toggle rotate"
    },
    {
      "hash": "a95de1b5",
      "date": "2026-01-31 22:27:12 -0600",
      "message": "Inline GIB-1N script includes and regenerate 1N pipeline outputs"
    },
    {
      "hash": "2505d6e7",
      "date": "2026-01-31 22:14:56 -0600",
      "message": "Delete GIB_1345"
    },
    {
      "hash": "e1849ad6",
      "date": "2026-01-31 21:55:30 -0600",
      "message": "Regenerate 1N scenario pipeline outputs and remove HTML bidding sheets"
    },
    {
      "hash": "b303902b",
      "date": "2026-01-31 19:42:54 -0800",
      "message": "Fix auction display order in quiz PDFs"
    }
  ]
};
    </script>
</head>
<body>
    <h1>Practice Bidding Scenarios</h1>
    <p class="subtitle">Development Activity Dashboard</p>

    <div class="stats">
        <div class="stat-box">
            <div class="stat-value" id="scenarioCount">-</div>
            <div class="stat-label">Scenarios</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="commitCount">-</div>
            <div class="stat-label">Commits (Year)</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="sessionHours">-</div>
            <div class="stat-label">Hours in VSCode</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="pipelineRuns">-</div>
            <div class="stat-label">Pipeline Runs</div>
        </div>
    </div>

    <div class="chart-card" style="margin-bottom: 20px;">
        <h3>Cumulative Scenarios</h3>
        <canvas id="scenariosChart"></canvas>
    </div>

    <div class="chart-grid">
        <div class="chart-card">
            <h3>Git Commits</h3>
            <canvas id="commitsChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>File Edits</h3>
            <canvas id="editsChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>Pipeline Runs</h3>
            <canvas id="pipelineChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>VSCode Session Time (Hours)</h3>
            <canvas id="sessionChart"></canvas>
        </div>
    </div>

    <div class="activity-grid">
        <div class="activity-card">
            <h3>Recent Activity</h3>
            <div class="activity-list" id="recentActivity">
                <div class="no-data">No activity logged yet</div>
            </div>
        </div>
        <div class="activity-card">
            <h3>Recent Commits</h3>
            <div class="activity-list" id="recentCommits">
                <div class="no-data">No commits found</div>
            </div>
        </div>
    </div>

    <p class="footer">
        Last updated: <span id="lastUpdated">-</span>
        <br>
        <small>Run <code>python3 py/generateDashboardData.py</code> to refresh</small>
    </p>

    <script>
        // Chart configuration defaults
        const chartDefaults = {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1 }
                }
            }
        };

        function createChart(canvasId, label, data, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels || [],
                    datasets: [{
                        label: label,
                        data: data.values || [],
                        backgroundColor: color + '40',
                        borderColor: color,
                        borderWidth: 1
                    }]
                },
                options: chartDefaults
            });
        }

        function formatTime(isoString) {
            try {
                const date = new Date(isoString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch {
                return isoString;
            }
        }

        function formatActivityDetails(event) {
            const details = event.details || {};
            switch (event.type) {
                case 'file_save':
                    return details.filePath || 'Unknown file';
                case 'pipeline_run':
                    return `${details.scenario || '?'} - ${details.operation || '?'}`;
                case 'session_start':
                    return 'Session started';
                case 'session_end':
                    const mins = details.durationMinutes;
                    return mins ? `Session ended (${mins} min)` : 'Session ended';
                default:
                    return event.type;
            }
        }

        function renderDashboard(data) {
            if (!data) {
                console.warn('No dashboard data available');
                return;
            }

            // Update summary stats
            const summary = data.summary || {};
            document.getElementById('scenarioCount').textContent = summary.totalScenarios || 0;
            document.getElementById('commitCount').textContent = summary.totalCommits || 0;
            document.getElementById('sessionHours').textContent =
                summary.totalSessionHours || 0;
            document.getElementById('pipelineRuns').textContent = summary.totalPipelineRuns || 0;

            // Update charts
            const charts = data.charts || {};
            const labels = charts.labels || [];

            createChart('commitsChart', 'Commits',
                { labels, values: charts.commits || [] }, '#6366f1');
            createChart('editsChart', 'File Edits',
                { labels, values: charts.fileEdits || [] }, '#2563eb');
            createChart('pipelineChart', 'Pipeline Runs',
                { labels, values: charts.pipelineRuns || [] }, '#16a34a');

            // Session hours estimated from git commit patterns
            createChart('sessionChart', 'Hours',
                { labels, values: charts.sessionHours || [] }, '#ea580c');

            // Scenarios worked over time
            createChart('scenariosChart', 'Scenarios',
                { labels, values: charts.scenariosWorked || [] }, '#8b5cf6');

            // Render recent activity
            const activityList = document.getElementById('recentActivity');
            const recentActivity = (data.recentActivity || []).slice().reverse();
            if (recentActivity.length > 0) {
                activityList.innerHTML = recentActivity.map(event => `
                    <div class="activity-item">
                        <div>
                            <span class="activity-type type-${event.type}">${event.type.replace('_', ' ')}</span>
                            <span style="margin-left: 8px;">${formatActivityDetails(event)}</span>
                        </div>
                        <span class="activity-time">${formatTime(event.timestamp)}</span>
                    </div>
                `).join('');
            }

            // Render recent commits
            const commitsList = document.getElementById('recentCommits');
            const recentCommits = data.recentCommits || [];
            if (recentCommits.length > 0) {
                commitsList.innerHTML = recentCommits.map(commit => `
                    <div class="commit-item">
                        <span class="commit-hash">${commit.hash}</span>
                        <span class="commit-message">${commit.message}</span>
                        <span class="commit-date">${commit.date}</span>
                    </div>
                `).join('');
            }

            // Update timestamp
            if (data.generatedAt) {
                document.getElementById('lastUpdated').textContent = formatTime(data.generatedAt);
            }
        }

        // Load dashboard data
        if (typeof DASHBOARD_DATA !== 'undefined') {
            renderDashboard(DASHBOARD_DATA);
        } else {
            // Try to fetch from JSON file (works with local server)
            fetch('dashboard-data.json')
                .then(r => r.json())
                .then(renderDashboard)
                .catch(() => console.warn('No dashboard data available. Run generateDashboardData.py'));
        }
    </script>
</body>
</html>
