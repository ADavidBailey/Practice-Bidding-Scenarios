Script,MaximalAfterOvercall
setDealerCode(`

# convention-card: 21GF-MaximalDouble
# auction-filter: 1. 1H .* 2H\n3D|1. 1S .* 2S\n3H

# Maximal after We Overcall
dealer east

Import,https://github.com/ADavidBailey/Practice-Bidding-Scenarios/blob/main/script/Total-Points-All

## Predict East's Opening 1-Bid -- 1H, 1D, 1C ##
# Define east's opening 1NT so we can exclude it
# GIB opens 1N w/15-17 HCP or 15-16 and a 5-card major
ntP = hcp(east) + shape(east,5xxx+x5xx)
nt1 = shape(east, any 5332+any 4432+any 4333) and hcp(east)>14 and ntP<18

# GIB does not open with 5422 and a 5-card major
# GIB does not open with 5422 and the strength to reverse
nt2 = shape(east, any 5422-5xxx-x5xx) and hcp(east)>14 and hcp(east)<17

gibNT = nt1 or nt2

# Calculate length points for East (lengthPoints)
lp1 = spades(east)>4 ? spades(east)-4 : 0
lp2 = hearts(east)>4 ? hearts(east)-4 : 0
lp3 = diamonds(east)>4 ? diamonds(east)-4 : 0
lp4 = clubs(east)>4 ? clubs(east)-4 : 0
lengthPoints = lp1 + lp2 + lp3 + lp4

# Define suit points for east (suitPoints)
suitPoints = hcp(east) + lengthPoints

# Predict East's Opening suit
s = spades(east)
h = hearts(east)
d = diamonds(east)
c = clubs(east)
e1Range = suitPoints>11 and hcp(east)>9
oS = s>4 and s>=h and s>=d and s>=c and e1Range and not P2
oH = not oS and h>4 and h>=d and h>=c and e1Range and not P2
oD = not (oS or oH) and ((d>3 and d>=c) or c<3) and e1Range and not P2
oC = not (oS or oH or oD) and e1Range and not P2
openingSuit = (oS or oH or oD or oC)

eOpens = (oH or oD or oC) and hcp(east)<19 and not gibNT

## South overcalls 1H or 1S
Import,https://github.com/ADavidBailey/Practice-Bidding-Scenarios/blob/main/script/Total-Points-South
# Defines sTP

sRange = hcp(south)>7 and hcp(south)<18 and sTP>8 and sTP<20  // per GIB

s1S = (oC or oD or oH) and spades(south)>4 and spades(north)>2
s1H = (oC or oD)       and hearts(south)>4 and hearts(north)>2
sOvercalls = (s1S or s1H) and sRange

# West bids the Maximal suit
wRange = wTP>10



# West oes whatever and Ndorth rasies
nraise = hcp(north)>9

# Define East bids 3 Maximal suit
e3D = H_ and diamonds(east)>5 and top3(east,diamonds)>1 and spades(east)<5
e3H = S_ and hearts(east)>5   and top3(east,hearts)>1
eShape = shape(east,any 7xxx +any 6xxx -any 76xx -any 75xx -any 66xx -any 65xx)
eRange = hcp(east)>10 and hcp(east)<14 and controls(east)>2
eMaxBid = (e2D or e2H) and eRange and eShape

# avoid other overcalls
eWJS    = shape(east,any 9xxx +any 8xxx +any 7xxx +any 6xxx) and hcp(east)<11
e2suits = shape(east,any 85xx +any 76xx + any 75xx +any 65xx +any 55xx)
HS = spades(east)>4 and hcp(east)>5
HC = clubs(east)>4 and hcp(east)>9
SC = spades(east)>4 and hcp(east)>9
SD = diamonds(east)>4 and hcp(east)>9
ePass = not (eWJS or e2suits or HS or HC or SC or SD)

# Define East Takeout Double
eHCP = hcp(east,spades)<7 and hcp(east,hearts)<7 and hcp(east,diamonds)<7 and hcp(east,clubs)<7  // no concentration
eHX = H_ and hearts(east)<2 and shape(east,any 5440 +any 5431 +any 4441 -5xxx) and hcp(east,hearts)<2 and spades(west)<4
eSX = S_ and spades(east)<2 and shape(east,any 5440 +any 5431 +any 4441 -x5xx) and hcp(east,spades)<2 and hearts(west)<4
eX = (eHX or eSX) and eHCP and hcp(east)>10 and hcp(east)<15 and not eMaxOC

# Define East bids
eBids = ePass or eX or eMaxOC

# Define South's major suit raises
spadeFit = S_ and shape(south,3xxx+4xxx) and hcp(south,spades)>1 and (controls(south)-controls(south,spades)==1)
heartFit = H_ and shape(south,x3xx+x4xx) and hcp(south,hearts)>1 and (controls(south)-controls(south,hearts)==1) and spades(south)<4

# Define South's major suit jump raises 
# 3=Free jump raise  -- 4+ cards; 8- HCP; 7+ total points
# 4=Preemptive raise -- 4+ cards; 9- HCP; 6+ total points
sJump = spadeFit and spades(south)>4
hJump = heartFit and hearts(south)>4
jRaise   = (sJump or hJump) and sTP>5 and hcp(south)<10

# Define South's major suit raises with 3/4-cards
sRaise   = (spadeFit or heartFit) and sTP>5 and sTP<11 and hcp(south)<10 and shape(south,xxxx -any 4333) and not jRaise

# Define West's raise of Maximal overcall
wHR = e2H and shape(west,x3xx+x4xx) and hcp(west,hearts)>1
wDR = e2D and shape(west,xx3x+xx4x) and hcp(west,diamonds)>1
wRaise = (wHR or wDR) and hcp(west)>6 and hcp(west)<11

# Define West's response to X
wD = heartFit and diamonds(west)>4
wH = spadeFit and hearts(west)>4
wRespToX = eX and (wD or wH) and shape(west,xxxx-any 76xx -any 75xx -any 65xx -any 55xx) and hcp(west)>6 and hcp(west)<11

# Define West's free bid of Maximal suit.
wGD = heartFit and top4(west,diamonds)>2  and shape(west,xx6x)
wGH = spadeFit and top4(west,hearts)>2    and shape(west,x6xx)
wFreeBid = ePass and (wGD or wGH) and shape(west,any 0xxx +any 1xxx -any 76xx -any 75xx -any 66xx -any 65xx) and hcp(west)>10 and hcp(west)<14

# Define West's 3 of the Maximal suit
w3Max = (wRaise or wRespToX or wFreeBid)

Import,https://github.com/ADavidBailey/Practice-Bidding-Scenarios/blob/main/script/Leveling

nMin = nTP<15
nMax = nTP>14

levMax = nMax and keep
levMin = nMin and keep

levelTheDeal = (levMax or levMin)

# Now do it
n1M and eBids and sRaise and w3Max
and levelTheDeal

produce 5000
action
average "free bid       " 100 * wFreeBid,
average "raise          " 100 * wRaise,
average "response to X  " 100 * wRespToX,
average "north 12-14 TP " 100 * nMin,
average "north 15+   TP " 100 * nMax,
frequency "HCP North    "  (nTP, 11, 23),

`, "N", true)
Script

Button,Maximal Double,\n\
--- Maximal Overcall Double:  After we've bid and raised a major suit\n\
and they compete in the suit just under ours (the Maximal suit) we need\n\
to distinguish between a competitive raise and an invitational raise.\n\
The Maximal Double is the answer:\n\
  • After 1!H (?) 2!H (3!D)，3!H is competitive and X is invitational\n\
  • After 1!S (?) 2!S (3!H)，3!S is competitive and X is invitational\n\
The BBO Robots do NOT play this.\n\
https://www.nvba.org/novices/Robert_Todd/(195)+Maximal+Doubles.pdf\n\
%MaximalDouble%,backgroundColor=lightpink